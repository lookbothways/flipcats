<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Clone</title>
    <style>
        :root {
            --bg-color: #f6f7fb; --card-bg: #ffffff; --text-main: #303545;
            --accent-orange: #ffcd1f; --accent-green: #23b26d; --accent-blue: #4255ff;
            --border-color: #edeff4; --shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        header { padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; background: white; border-bottom: 2px solid var(--border-color); gap: 10px; }
        select { padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); flex-grow: 1; max-width: 200px; font-size: 0.9rem; }
        .creator-btn { text-decoration: none; color: #939bb4; font-size: 1.8rem; line-height: 1; padding: 0 5px; transition: color 0.2s; }
        .creator-btn:hover { color: var(--accent-blue); }

        .stats-bar { display: flex; justify-content: center; gap: 30px; padding: 15px 0; font-weight: 700; font-size: 0.9rem; }
        .still-learning { color: #d9822b; } .know { color: var(--accent-green); }
        .count-badge { padding: 2px 12px; border-radius: 20px; border: 2px solid #eee; background: white; }

        .card-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; perspective: 1000px; padding: 20px; }
        .card { width: 100%; max-width: 400px; height: 400px; position: relative; transform-style: preserve-3d; transition: transform 0.4s; cursor: pointer; }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; background: white; border-radius: 24px; box-shadow: var(--shadow); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .card-back { transform: rotateY(180deg); background-color: #fafaff; }
        .card-content { font-size: 3.5rem; font-weight: 700; word-break: break-word; }
        .label { position: absolute; top: 20px; left: 20px; font-size: 0.7rem; color: #939bb4; text-transform: uppercase; }

        .action-buttons { display: flex; justify-content: center; gap: 20px; padding-bottom: 30px; }
        .btn-circle { width: 60px; height: 60px; border-radius: 50%; border: 1px solid #eee; background: white; cursor: pointer; font-size: 1.5rem; transition: 0.1s; }
        .btn-circle:active { transform: scale(0.9); }
        .btn-x { color: #f05454; } .btn-check { color: var(--accent-green); }

        footer { padding: 15px 20px; display: flex; justify-content: space-between; background: white; border-top: 1px solid var(--border-color); }
    </style>
</head>
<body>

    <header>
        <select id="deck-selector" onchange="loadDeck(this.value)">
            <option value="">Loading decks...</option>
        </select>
        <div id="progress-header">0 / 0</div>
        <a href="cardCreator.html" class="creator-btn" title="Create New Deck">+</a>
    </header>

    <div id="game-view">
        <div class="stats-bar">
            <div class="stat-item still-learning"><span class="count-badge" id="sl-count">0</span> Remaining</div>
            <div class="stat-item know">Mastered <span class="count-badge" id="k-count">0</span></div>
        </div>

        <div class="card-container">
            <div class="card" id="flashcard" onclick="this.classList.toggle('flipped')">
                <div class="card-face card-front">
                    <span class="label" id="front-label">Front</span>
                    <div class="card-content" id="front-text">--</div>
                </div>
                <div class="card-face card-back">
                    <span class="label" id="back-label">Back</span>
                    <div class="card-content" id="back-text">--</div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn-circle btn-x" onclick="answer(false)" title="Still Learning">✕</button>
            <button class="btn-circle btn-check" onclick="answer(true)" title="Know It">✓</button>
        </div>

        <footer>
            <button onclick="initDeck()" title="Restart Deck" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">↺</button>
            <span style="color:var(--accent-blue); font-weight:600; font-size:0.8rem;">Mastery Mode</span>
            <button onclick="shuffleActive()" title="Shuffle Remaining" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">⇄</button>
        </footer>
    </div>

    <script>
        let fullDeck = [];      // Original data
        let activeCards = [];   // Cards still being learned
        let currentIndex = 0;   // Current position in activeCards
        let scoreKnow = 0;      // How many have been mastered

        async function initApp() {
            try {
                const response = await fetch('manifest.json');
                const decks = await response.json();
                const selector = document.getElementById('deck-selector');
                selector.innerHTML = '';
                
                decks.forEach(deck => {
                    let opt = document.createElement('option');
                    opt.value = deck.file;
                    opt.innerHTML = deck.name;
                    selector.appendChild(opt);
                });

                loadDeck(decks[0].file);
            } catch (e) {
                alert("Error loading manifest.json. Ensure it's on a web server or GitHub Pages.");
            }
        }

        async function loadDeck(filename) {
            try {
                const response = await fetch(filename);
                const data = await response.json();
                fullDeck = data.cards;
                document.getElementById('front-label').innerText = data.frontLabel || "Front";
                document.getElementById('back-label').innerText = data.backLabel || "Back";
                initDeck();
            } catch (e) {
                alert("Error loading card file: " + filename);
            }
        }

        function initDeck() {
            // Clone the full deck into active cards and start fresh
            activeCards = [...fullDeck];
            scoreKnow = 0;
            currentIndex = 0;
            shuffleActive();
            updateUI();
        }

        function shuffleActive() {
            activeCards.sort(() => Math.random() - 0.5);
            currentIndex = 0;
            updateUI();
        }

        function answer(known) {
            if (activeCards.length === 0) return;

            if (known) {
                // Remove the mastered card from play
                activeCards.splice(currentIndex, 1);
                scoreKnow++;
                // No need to increment currentIndex because the next card 
                // shifted into the current index position.
            } else {
                // Keep it in the list, just move to the next card
                currentIndex++;
            }

            // If we've reached the end of the current pile, wrap back to the start
            if (currentIndex >= activeCards.length) {
                currentIndex = 0;
                // Optional: Shuffle the remaining "not known" cards for the next round
                activeCards.sort(() => Math.random() - 0.5);
            }

            updateUI();
        }

        function updateUI() {
            const card = document.getElementById('flashcard');
            card.classList.remove('flipped');

            // Header shows Mastery progress: [Mastered] / [Total]
            document.getElementById('progress-header').innerText = `${scoreKnow} / ${fullDeck.length}`;
            
            // Stats bar
            document.getElementById('sl-count').innerText = activeCards.length;
            document.getElementById('k-count').innerText = scoreKnow;

            if (activeCards.length === 0) {
                setTimeout(() => {
                    document.getElementById('front-text').innerText = "Done!";
                    document.getElementById('back-text').innerText = "Da iawn! (Well done)";
                }, 100);
                return;
            }

            // Update card content
            setTimeout(() => {
                const current = activeCards[currentIndex];
                document.getElementById('front-text').innerText = current.f;
                document.getElementById('back-text').innerText = current.b;
            }, 100);
        }

        initApp();
    </script>
</body>
</html>